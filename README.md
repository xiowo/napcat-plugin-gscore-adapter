# 🦊 NapCat早柚核心适配器 (napcat-plugin-gscore-adapter)

这是一个适用于 [NapCat](https://github.com/NapNeko/NapCatQQ) 的 GScore (早柚核心) 适配器插件。它通过 WebSocket 连接 GScore 服务，将 QQ 消息转发给 GScore 处理，并支持丰富的管理功能。

## ✨ 主要功能

- **🚀 无缝对接**: 无需中间Bot框架即可将 NapCat 连接至 GScore 服务。
- **⚙️ WebUI 配置**: 支持通过 NapCat WebUI 直接修改配置，无需手动编辑文件。
- **🛡️ 权限管理**: 支持设置主人 QQ，群组管理仅限管理员/群主或指定主人操作。
- **📝 群组管理**: 独立控制每个群组是否启用 GScore 响应。
- **🚫 黑名单系统**: 支持拉黑指定用户，忽略其消息触发。
- **🔄 断线重连**: 自动检测连接状态并在断开后尝试重连。
- **📊 状态监控**: 内置状态查看指令，随时掌握连接情况。

## 🛠️ 安装说明

1. 将本插件放置在 NapCat 的 `plugins` 目录下。
2. 重启 NapCat。
3. 在 NapCat WebUI 的插件管理页面启用本插件。

## 📝 配置指南

在 NapCat WebUI 的插件配置页面中，您可以自定义以下选项：

| 配置项 | 说明 | 默认值 |
| :--- | :--- | :--- |
| **启用 GScore 适配** | 全局开关，是否转发消息 | `true` |
| **连接地址** | GScore 的 WebSocket 地址 | `ws://localhost:8765` |
| **连接 Token** | 如果 GScore 需要鉴权，在此填入 Token | `空` |
| **重连间隔** | 断线重连的时间间隔 (ms) | `5000` |
| **最大重连次数** | 最大尝试重连次数，0 为无限重连 | `10` |
| **命令前缀** | 群内触发指令的前缀 | `#早柚` |
| **主人QQ** | 留空默认群主/管理员可使用群内命令，设置后仅填写 QQ 可执行管理指令（同时忽略群主/管理员权限），多个请使用英文逗号分隔 | `空` |

> ⚠️ **注意**: 如果您在 Docker 环境下运行 NapCat，请勿将连接地址设置为 `localhost` 或 `127.0.0.1`，请使用宿主机 IP (如 `172.17.0.1`) 或 Docker Network 容器名。

## 📜 指令列表

默认命令前缀为 `#早柚` (可在配置中修改)。

| 指令 | 描述 | 权限要求 |
| :--- | :--- | :--- |
| `#早柚 help` | 查看帮助信息 | 无 |
| `#早柚 status` | 查看连接状态、运行时长、黑名单人数 | 无 |
| `#早柚群开启` / `#早柚群启用` | 开启本群 GScore 适配（开始转发消息） | 管理员/群主/主人 |
| `#早柚群关闭` / `#早柚群禁用` | 关闭本群 GScore 适配（停止转发消息） | 管理员/群主/主人 |
| `#早柚拉黑 @用户` | 拉黑用户（不转发其消息） | 管理员/群主/主人 |
| `#早柚取消拉黑 @用户` | 取消拉黑用户 | 管理员/群主/主人 |

## ❓ 常见问题 (FAQ)

### Q1: 无法连接到 GScore (Connection Refused)?
**A**:
1. 请确保 GScore 服务已正常启动并在指定的端口监听。
2. 如果 NapCat 运行在 Docker 容器中，容器内的 `127.0.0.1` 指向的是容器本身，而非宿主机。请使用宿主机 IP（通常是 `172.17.0.1`）或确保双容器可使用同一 Docker Network 并使用容器名连接，如果你使用早柚仓库下的 `dockerfile` 构建容器的话，会自动创建 `gscore_default` 网络，将napcat加入该网络，然后设置连接地址设为`ws://gscore_default:8765` 即可。

### Q2: 为什么输入指令没有任何反应？
**A**:
1. 请检查插件是否已启用（WebUI 中查看）。
2. 确认你使用的命令前缀是否正确（默认为 `#早柚`）。
3. 检查你是否具有相应的权限。如果未配置 `主人QQ`，则只有群主/管理员可以使用群内指令；如果配置了 `主人QQ`，则只有该 QQ 可以使用群内指令。

## 📄 License
MIT License
